services:
  app:
    container_name: openskidata-processor
    build:
      context: .
      target: development
    volumes:
      - .:/app
      - node_modules:/app/node_modules
      - dist:/app/dist
      - postgres_data:/var/lib/postgresql/data
    working_dir: /app
    stdin_open: true
    tty: true
    ports:
      # PostgreSQL inside the container listens on 5432.
      # Host port 5433 is used to avoid clashing with a local Postgres on 5432.
      # If you want to restrict access to localhost only, change to: "127.0.0.1:5433:5432"
      - "5433:5432"
    environment:
      - POSTGRES_USER=dev
      - POSTGRES_PASSWORD=dev
      #- BBOX=[10.74827, 46.81017, 11.08733, 47.00510]
      - BBOX=[11.85573,47.223133,12.119387,47.42013 ]
      - OUTPUT_TO_FILES=1
      - OUTPUT_TO_POSTGIS=1
      - ELEVATION_SERVER_URL=https://s3.amazonaws.com/elevation-tiles-prod/geotiff
      - ELEVATION_SERVER_TYPE=aws-terrain-tiles
      - ELEVATION_SERVER_ZOOM=15
      # Set to true to use bilinear interpolation for elevation values, false for raw raster cell values
      - INTERPOLATE_HEIGHT_INFORMATION=true
      # Set to false to only start PostgreSQL without running the processing pipeline
      - COMPILE_NEW=true

volumes:
  node_modules:
  dist:
  postgres_data:
